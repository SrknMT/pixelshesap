<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pixels Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="data.js"></script> 
    
    <style>
        /* --- TEMA AYARLARI --- */
        :root {
            --neon-yellow: #ccff00;
            --pixels-purple: #6246ea;
            --bg-dark: #130822;
            --bg-card: #201036;
            --border-color: #4c1d95;
            --text-main: #f3f4f6;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            -webkit-tap-highlight-color: transparent; 
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--pixels-purple); border-radius: 2px; }

        /* --- INPUTS --- */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .game-input {
            background: #0f0518;
            border: 1px solid var(--border-color);
            color: white;
            border-radius: 8px;
            width: 100%;
            padding: 10px;
            outline: none;
            transition: all 0.2s;
            font-weight: bold;
            font-size: 16px;
        }
        .game-input:focus { border-color: var(--neon-yellow); }

        /* Arama ve Filtre */
        .search-bar {
            background: #0f0518;
            border: 1px solid var(--border-color);
            color: white;
            border-radius: 8px 0 0 8px;
            padding: 12px;
            width: 100%;
            outline: none;
            font-size: 14px;
        }
        
        .filter-select {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--neon-yellow);
            border-radius: 0 8px 8px 0;
            padding: 0 12px;
            outline: none;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            border-left: none;
        }

        /* --- UI ELEMENTS --- */
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; padding: 12px 0; color: #a78bfa; transition: all 0.2s; border-top: 3px solid transparent; }
        .nav-btn.active { color: var(--neon-yellow); border-top-color: var(--neon-yellow); background: linear-gradient(to bottom, rgba(98, 70, 234, 0.15), transparent); }
        .nav-btn svg { width: 26px; height: 26px; margin-bottom: 4px; }
        .nav-text { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }

        .glass-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .table-header { font-size: 11px; font-weight: 900; color: #a78bfa; text-transform: uppercase; letter-spacing: 0.5px; }
        
        /* Grid Column Config - GÃœNCELLENDÄ°: Silme butonu kalkÄ±nca ÃœrÃ¼n sÃ¼tunu geniÅŸledi */
        .col-prod { grid-column: span 5; } /* Eskiden 4'tÃ¼ */
        .col-pe   { grid-column: span 2; text-align: right; }
        .col-exp  { grid-column: span 2; text-align: center; }
        .col-sell { grid-column: span 2; }
        .col-time { grid-column: span 1; text-align: center; }

    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <header class="bg-[#130822] border-b border-[#4c1d95] shrink-0 z-30 h-16 flex items-center justify-between px-4 shadow-lg">
        <div class="flex items-center gap-3">
            <div class="bg-[#6246ea] w-10 h-10 rounded-lg flex items-center justify-center border border-[#ccff00] shadow-[0_0_10px_rgba(98,70,234,0.5)]">
                <span class="text-[#ccff00] font-black text-2xl">P</span>
            </div>
            <div>
                <h1 class="font-black text-xl text-white leading-none tracking-tight">PIXELS <span class="text-[#ccff00]">PRO</span></h1>
            </div>
        </div>
        <div class="bg-gradient-to-r from-[#6246ea] to-[#4c1d95] border border-[#ccff00] px-4 py-1.5 rounded-lg text-white font-bold text-sm shadow-[0_0_10px_rgba(204,255,0,0.2)]">
            LVL <span id="headerTotalLevel">0</span>
        </div>
    </header>

    <div class="flex-1 overflow-hidden relative">
        
        <div id="view-craft" class="page-view h-full flex flex-col">
            <div class="p-3 bg-[#130822] border-b border-[#4c1d95] flex sticky top-0 z-20">
                <input type="text" id="searchCraft" placeholder="ÃœrÃ¼n Ara..." class="search-bar" oninput="renderTable('craftContainer', craftData, 'searchCraft', 'filterCraft')">
                <select id="filterCraft" class="filter-select" onchange="renderTable('craftContainer', craftData, 'searchCraft', 'filterCraft')">
                    <option value="ALL">TÃœMÃœ</option>
                    </select>
            </div>

            <div class="grid grid-cols-12 gap-2 bg-[#2d1b4e] py-3 px-3 border-b border-[#4c1d95] shrink-0 items-center sticky top-[66px] z-10 shadow-md">
                <div class="col-prod pl-1 table-header text-white">ÃœRÃœN</div>
                <div class="col-pe table-header text-emerald-400">P/E</div>
                <div class="col-exp table-header text-blue-300">XP/EN</div>
                <div class="col-sell table-header text-[#ccff00] text-right pr-2">SATIÅž</div>
                <div class="col-time table-header text-slate-400">SÃœRE</div>
            </div>
            <div id="craftContainer" class="flex-1 overflow-y-auto p-2 space-y-2 pb-24 custom-scrollbar"></div>
        </div>

        <div id="view-raw" class="page-view h-full flex flex-col hidden">
            <div class="p-3 bg-[#130822] border-b border-[#4c1d95] flex sticky top-0 z-20">
                <input type="text" id="searchRaw" placeholder="Hammadde Ara..." class="search-bar" oninput="renderTable('rawContainer', rawData, 'searchRaw', 'filterRaw')">
                <select id="filterRaw" class="filter-select" onchange="renderTable('rawContainer', rawData, 'searchRaw', 'filterRaw')">
                    <option value="ALL">TÃœMÃœ</option>
                </select>
            </div>

            <div class="grid grid-cols-12 gap-2 bg-[#2d1b4e] py-3 px-3 border-b border-[#4c1d95] shrink-0 items-center sticky top-[66px] z-10 shadow-md">
                <div class="col-prod pl-1 table-header text-white">HAMMADDE</div>
                <div class="col-pe table-header text-emerald-400">P/E</div>
                <div class="col-exp table-header text-blue-300">XP/EN</div>
                <div class="col-sell table-header text-[#ccff00] text-right pr-2">SATIÅž</div>
                <div class="col-time table-header text-slate-400">SÃœRE</div>
            </div>
            <div id="rawContainer" class="flex-1 overflow-y-auto p-2 space-y-2 pb-24 custom-scrollbar"></div>
        </div>

        <div id="view-profile" class="page-view h-full overflow-y-auto hidden p-4 pb-24">
            <div class="max-w-lg mx-auto space-y-4">
                <div class="glass-card p-4 flex justify-between items-center bg-gradient-to-r from-[#2d1b4e] to-[#130822]">
                    <div>
                        <h2 class="text-lg font-black text-white uppercase tracking-wider">Yetenekler</h2>
                        <p class="text-[10px] text-purple-300">Seviyelerini gÃ¼ncel tut.</p>
                    </div>
                    <button onclick="saveProfile()" class="bg-[#ccff00] hover:bg-[#b3e600] text-black px-6 py-2.5 rounded-lg font-bold shadow-[0_0_15px_rgba(204,255,0,0.3)] active:scale-95 transition-transform uppercase text-xs">
                        KAYDET
                    </button>
                </div>
                <div class="space-y-3" id="skillsList"></div>
            </div>
        </div>

        <div id="view-calc" class="page-view h-full overflow-y-auto hidden p-4 pb-24">
            <div class="max-w-lg mx-auto space-y-5">
                
                <div class="glass-card p-5 space-y-5 bg-[#201036]">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="table-header block mb-2">YETENEK</label>
                            <select id="calcSkillSelect" class="game-input text-sm" style="background-image:none;" onchange="updateCalcSkillContext()"></select>
                        </div>
                        <div>
                            <label class="table-header block mb-2 text-[#ccff00]">ÃœRÃœN SEÃ‡</label>
                            <select id="calcItemSelect" class="game-input text-sm border-[#ccff00]" style="background-image:none;" onchange="autoFillCalc()">
                                <option value="">-- Listeden SeÃ§ --</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex items-end gap-3 pt-3 border-t border-[#4c1d95]">
                        <div class="w-1/3">
                            <label class="table-header block mb-2 text-center">MEVCUT</label>
                            <div id="calcCurrentLvl" class="text-3xl font-black text-white bg-[#0f0518] py-2 rounded-lg border border-[#4c1d95] text-center">-</div>
                        </div>
                        <div class="pb-5 text-purple-500 font-bold text-xl">âžœ</div>
                        <div class="flex-1">
                            <label class="table-header block mb-2 text-[#ccff00]">HEDEF LEVEL</label>
                            <input type="number" id="calcTargetLvl" class="game-input text-center text-3xl font-black h-[54px]" value="10" oninput="calculate()">
                        </div>
                    </div>
                    <div class="text-right text-xs text-purple-300">
                        Gereken XP: <span id="calcNeededXP" class="text-white font-bold">0</span>
                    </div>
                </div>

                <div class="glass-card p-4">
                    <h3 class="table-header mb-3 border-b border-[#4c1d95] pb-2 text-white">MANUEL DEÄžERLER (BÄ°RÄ°M)</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <div>
                            <label class="text-[8px] text-blue-300 font-bold block mb-1 text-center">XP</label>
                            <input type="number" id="unitXP" class="game-input text-center text-sm p-2" placeholder="0" oninput="calculate()">
                        </div>
                        <div>
                            <label class="text-[8px] text-purple-300 font-bold block mb-1 text-center">ENERJÄ°</label>
                            <input type="number" id="unitEnergy" class="game-input text-center text-sm p-2" placeholder="0" oninput="calculate()">
                        </div>
                        <div>
                            <label class="text-[8px] text-red-400 font-bold block mb-1 text-center">MALÄ°YET</label>
                            <input type="number" id="unitCost" class="game-input text-center text-sm p-2" placeholder="0" oninput="calculate()">
                        </div>
                        <div>
                            <label class="text-[8px] text-[#ccff00] font-bold block mb-1 text-center">SATIÅž</label>
                            <input type="number" id="unitSalePrice" class="game-input text-center text-sm p-2" placeholder="0" oninput="calculate()">
                        </div>
                    </div>
                </div>

                <div class="glass-card p-0 overflow-hidden">
                    <div class="bg-[#4c1d95] p-2 text-center text-xs font-bold text-white tracking-widest">HESAP SONUCU</div>
                    <div class="p-5 grid grid-cols-2 gap-y-5 gap-x-4">
                        
                        <div class="space-y-1 border-r border-[#4c1d95] pr-2">
                            <div class="text-[10px] text-slate-400 uppercase font-bold">Ãœretim Adedi</div>
                            <div class="text-2xl font-black text-white" id="resCount">-</div>
                        </div>
                        
                        <div class="space-y-1 pl-2">
                            <div class="text-[10px] text-slate-400 uppercase font-bold">Toplam Enerji</div>
                            <div class="text-2xl font-bold text-purple-400" id="resTotalEnergy">-</div>
                        </div>

                        <div class="col-span-2 border-t border-[#4c1d95] pt-3 flex justify-between">
                            <span class="text-xs text-slate-400 font-bold">Enerji Maliyeti (1E=50c)</span>
                            <span class="text-sm font-bold text-red-400" id="resEnergyCost">-</span>
                        </div>
                        <div class="col-span-2 flex justify-between">
                            <span class="text-xs text-slate-400 font-bold">Materyal Maliyeti</span>
                            <span class="text-sm font-bold text-red-400" id="resMatCost">-</span>
                        </div>
                        <div class="col-span-2 border-t border-dashed border-[#4c1d95] pt-2 flex justify-between">
                            <span class="text-xs text-slate-300 font-bold">TOPLAM MALÄ°YET</span>
                            <span class="text-lg font-bold text-red-500" id="resTotalCost">-</span>
                        </div>
                        <div class="col-span-2 flex justify-between">
                            <span class="text-xs text-slate-300 font-bold">TOPLAM CÄ°RO</span>
                            <span class="text-lg font-bold text-[#ccff00]" id="resTotalSales">-</span>
                        </div>

                        <div class="col-span-2 mt-2 bg-[#0f0518] border border-[#ccff00] rounded-xl p-4 text-center">
                            <div class="text-[10px] text-[#ccff00] uppercase font-black tracking-widest">NET KÃ‚R / ZARAR</div>
                            <div class="text-4xl font-black text-white mt-2 drop-shadow-[0_0_10px_rgba(204,255,0,0.5)]" id="resProfitLoss">-</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <nav class="bg-[#130822] border-t border-[#4c1d95] flex justify-around pb-[env(safe-area-inset-bottom)] z-40 sticky bottom-0 w-full shrink-0 shadow-2xl">
        <button onclick="switchView('craft')" id="nav-craft" class="nav-btn active">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
            <span class="nav-text">Ãœretim</span>
        </button>
        <button onclick="switchView('raw')" id="nav-raw" class="nav-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span class="nav-text">Hammadde</span>
        </button>
        <button onclick="switchView('profile')" id="nav-profile" class="nav-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span class="nav-text">Profil</span>
        </button>
        <button onclick="switchView('calc')" id="nav-calc" class="nav-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
            <span class="nav-text">Hesap</span>
        </button>
    </nav>

    <script>
        // --- CONSTANTS ---
        const ENERGY_PRICE = 50; 
        const xp_table = [0, 100, 316, 661, 1148, 1792, 2609, 3618, 4839, 6294, 8007, 10006, 12321, 14985, 18035, 21512, 25460, 29929, 34974, 40655, 47039, 54200, 62220, 71189, 81207, 92384, 104843, 118718, 134158, 151327, 170408, 191601, 215129, 241237, 270196, 302306, 337899, 377341, 421037, 469434, 523027, 582362, 648043, 720738, 801184, 890196, 988675, 1097617, 1218122, 1351407, 1498815, 1661832, 1842099, 2041431, 2261832, 2505519, 2774940, 3072802, 3402097, 3766129, 4168553, 4613406, 5105150, 5648717, 6249557, 6913694, 7647784, 8459185, 9356027, 10347297, 11442925, 12653887, 13992313, 15471608, 17106587, 18913624, 20910815, 23118158, 25557755, 28254032, 31233985, 34527448, 38167393, 42190260, 46636322, 51550086, 56980741, 62982648, 69615887, 76946856, 85048935, 94003223, 103899347, 114836361, 126923737, 140282459, 155046236, 171362838, 189395578, 209324943, 231350404];
        
        const defaultSkills = [
            { id: "farming", name: "Farming", icon: "ðŸŽ", lvl: 1, xp: 0 },
            { id: "cooking", name: "Cooking", icon: "ðŸ³", lvl: 1, xp: 0 },
            { id: "woodworking", name: "Woodwork", icon: "ðŸª‘", lvl: 1, xp: 0 },
            { id: "forestry", name: "Forestry", icon: "ðŸŒ²", lvl: 1, xp: 0 },
            { id: "mining", name: "Mining", icon: "â›ï¸", lvl: 1, xp: 0 },
            { id: "metalworking", name: "Metalwork", icon: "ðŸ”¨", lvl: 1, xp: 0 },
            { id: "stoneshaping", name: "Stoneshape", icon: "ðŸ—¿", lvl: 1, xp: 0 },
            { id: "business", name: "Business", icon: "ðŸ’¼", lvl: 1, xp: 0 },
            { id: "animal", name: "Petcare", icon: "ðŸ¾", lvl: 1, xp: 0 },
            { id: "exploration", name: "Exploration", icon: "ðŸ”", lvl: 1, xp: 0 }
        ];

        let userSkills = JSON.parse(localStorage.getItem('pixels_user_skills')) || defaultSkills;
        let currentView = 'craft';

        window.onload = function() {
            if(typeof rawData === 'undefined' || typeof craftData === 'undefined') {
                alert("HATA: data.js bulunamadÄ±!"); return;
            }
            populateFilters();
            renderTable('craftContainer', craftData, 'searchCraft', 'filterCraft');
            renderProfile();
            updateTotalLevel();
            populateCalcSkillSelect();
        }

        function switchView(viewName) {
            currentView = viewName;
            document.querySelectorAll('.page-view').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.remove('hidden');
            document.getElementById('nav-' + viewName).classList.add('active');

            if(viewName === 'craft') renderTable('craftContainer', craftData, 'searchCraft', 'filterCraft');
            if(viewName === 'raw') renderTable('rawContainer', rawData, 'searchRaw', 'filterRaw');
        }

        function populateFilters() {
            const categories = new Set([...craftData, ...rawData].map(i => i.cat));
            const craftSel = document.getElementById('filterCraft');
            const rawSel = document.getElementById('filterRaw');
            
            // Alfabetik sÄ±rala
            const sortedCats = Array.from(categories).sort();

            sortedCats.forEach(cat => {
                const opt1 = document.createElement('option'); opt1.value = cat; opt1.innerText = cat;
                const opt2 = document.createElement('option'); opt2.value = cat; opt2.innerText = cat;
                craftSel.appendChild(opt1);
                rawSel.appendChild(opt2);
            });
        }

        function renderTable(containerId, data, searchId, filterId) {
            const container = document.getElementById(containerId);
            const searchVal = document.getElementById(searchId).value.toLowerCase();
            const filterVal = document.getElementById(filterId).value;
            
            container.innerHTML = '';

            const filteredData = data.map((item, index) => ({...item, originalIndex: index}))
                .filter(item => {
                    const matchSearch = item.name.toLowerCase().includes(searchVal);
                    const matchFilter = filterVal === "ALL" || item.cat === filterVal;
                    return matchSearch && matchFilter;
                });

            filteredData.forEach((item) => {
                let finalProfit = item.profit;
                let finalPE = item.pe;

                if(item.cost > 0) {
                    finalProfit = item.sell - item.cost;
                    if(item.en > 0) finalPE = (finalProfit / item.en).toFixed(2);
                } else if (containerId === 'rawContainer' && item.cost === 0) {
                    finalProfit = item.sell;
                    if(item.en > 0) finalPE = (item.sell / item.en).toFixed(2);
                }

                // Kategori Rengi
                let catColor = 'text-slate-400';
                if(item.cat.includes('Farming')) catColor = 'text-green-400';
                if(item.cat.includes('Cooking')) catColor = 'text-orange-400';
                if(item.cat.includes('Mining') || item.cat.includes('Stone')) catColor = 'text-blue-400';
                if(item.cat.includes('Wood')) catColor = 'text-amber-700';
                if(item.cat.includes('Business')) catColor = 'text-indigo-400';

                const row = document.createElement('div');
                row.className = 'grid grid-cols-12 gap-2 items-center bg-[#201036] border-b border-[#4c1d95] p-3 hover:bg-[#2d1b4e] transition-colors rounded-lg mb-1';
                
                // --- TABLO SATIRI (SÄ°L BUTONU YOK) ---
                row.innerHTML = `
                    <div class="col-prod flex flex-col">
                        <span class="font-bold uppercase ${catColor} text-[10px] tracking-wider">${item.cat}</span>
                        <span class="font-bold text-white truncate text-[14px] leading-tight">${item.name}</span>
                    </div>
                    
                    <div class="col-pe data-cell ${finalPE > 0 ? 'text-emerald-400' : 'text-red-500'} font-black text-[15px]">${formatNum(finalPE)}</div>
                    
                    <div class="col-exp flex flex-col items-center justify-center leading-tight">
                        <span class="data-cell text-blue-300 font-bold text-[13px]">${formatNum(item.exp)}</span>
                        <span class="data-cell text-purple-400 text-[11px]">${formatNum(item.en)}E</span>
                    </div>

                    <div class="col-sell text-right">
                         <input type="number" class="w-full bg-transparent text-right text-[#ccff00] font-bold text-[15px] outline-none focus:border-b border-[#ccff00]" value="${item.sell}" onchange="updateItem('${containerId}', ${item.originalIndex}, 'sell', this.value)">
                    </div>

                    <div class="col-time text-center data-cell text-slate-400 text-[13px]">${item.time}</div>
                `;
                container.appendChild(row);
            });
        }

        function updateItem(containerId, index, key, val) {
            const data = containerId === 'rawContainer' ? rawData : craftData;
            if(typeof val === 'string') val = parseFloat(val.replace(/\./g,'').replace(',','.'));
            data[index][key] = val || 0;
            if(containerId === 'rawContainer') renderTable(containerId, data, 'searchRaw', 'filterRaw');
            else renderTable(containerId, data, 'searchCraft', 'filterCraft');
        }

        // --- PROFILE ---
        function renderProfile() {
            const list = document.getElementById('skillsList');
            list.innerHTML = '';
            userSkills.forEach((skill, index) => {
                list.innerHTML += `
                    <div class="glass-card p-4 flex items-center gap-4 bg-[#201036]">
                        <div class="text-3xl">${skill.icon}</div>
                        <div class="flex-1">
                            <div class="text-xs font-black text-white uppercase mb-1 tracking-wider">${skill.name}</div>
                            <div class="flex gap-3">
                                <div class="flex flex-col w-1/4">
                                    <label class="text-[9px] text-purple-300 font-bold mb-1">LEVEL</label>
                                    <input type="number" id="pfl-lvl-${index}" value="${skill.lvl}" class="game-input text-center h-10 bg-[#0f0518] text-[#ccff00] text-lg font-black">
                                </div>
                                <div class="flex flex-col w-3/4">
                                    <label class="text-[9px] text-purple-300 font-bold mb-1">XP</label>
                                    <input type="number" id="pfl-xp-${index}" value="${skill.xp}" class="game-input text-center h-10 bg-[#0f0518] text-sm text-slate-300">
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function saveProfile() {
            userSkills.forEach((skill, index) => {
                skill.lvl = parseInt(document.getElementById(`pfl-lvl-${index}`).value) || 0;
                skill.xp = parseFloat(document.getElementById(`pfl-xp-${index}`).value) || 0;
            });
            localStorage.setItem('pixels_user_skills', JSON.stringify(userSkills));
            updateTotalLevel();
            populateCalcSkillSelect();
            alert("KAYDEDÄ°LDÄ° âœ…");
        }

        function updateTotalLevel() {
            const total = userSkills.reduce((acc, curr) => acc + curr.lvl, 0);
            document.getElementById('headerTotalLevel').innerText = total;
        }

        // --- CALCULATOR ---
        function getCumulativeXP(lvl) {
            if (lvl < 0) return 0;
            if (lvl >= xp_table.length) return xp_table[xp_table.length - 1];
            return xp_table[lvl];
        }

        function populateCalcSkillSelect() {
            const sel = document.getElementById('calcSkillSelect');
            const currentVal = sel.value;
            sel.innerHTML = '';
            userSkills.forEach((skill, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.innerText = `${skill.name}`;
                sel.appendChild(opt);
            });
            if(currentVal && currentVal < userSkills.length) sel.value = currentVal;
            updateCalcSkillContext();
        }

        function updateCalcSkillContext() {
            const idx = document.getElementById('calcSkillSelect').value;
            const skill = userSkills[idx];
            document.getElementById('calcCurrentLvl').innerText = skill.lvl;
            let nextTarget = Math.ceil((skill.lvl + 1) / 10) * 10;
            if (nextTarget <= skill.lvl) nextTarget += 10;
            document.getElementById('calcTargetLvl').value = nextTarget;
            populateItemSelect(skill.name);
            calculate();
        }

        function populateItemSelect(skillName) {
            const sel = document.getElementById('calcItemSelect');
            sel.innerHTML = '<option value="">-- Listeden SeÃ§ --</option>';
            const allItems = [...craftData, ...rawData];
            const filtered = allItems.filter(i => {
                if(skillName === 'Woodwork') return i.cat.includes('Wood');
                if(skillName === 'Metalwork') return i.cat.includes('Metal');
                if(skillName === 'Stoneshape') return i.cat.includes('Stone') || i.cat.includes('Mining');
                if(skillName === 'Petcare') return i.cat.includes('Animal');
                return i.cat.includes(skillName);
            });
            filtered.sort((a,b) => a.name.localeCompare(b.name));
            filtered.forEach(item => {
                const opt = document.createElement('option');
                opt.value = JSON.stringify({ xp: item.exp, en: item.en, sell: item.sell, cost: item.cost });
                opt.innerText = item.name;
                sel.appendChild(opt);
            });
        }

        function autoFillCalc() {
            const val = document.getElementById('calcItemSelect').value;
            if(!val) return;
            const data = JSON.parse(val);
            document.getElementById('unitXP').value = data.xp;
            document.getElementById('unitEnergy').value = data.en;
            document.getElementById('unitSalePrice').value = data.sell;
            document.getElementById('unitCost').value = data.cost || 0;
            calculate();
        }

        function calculate() {
            const idx = document.getElementById('calcSkillSelect').value;
            const skill = userSkills[idx];
            const targetLvl = parseInt(document.getElementById('calcTargetLvl').value) || 0;
            const unitXP = parseFloat(document.getElementById('unitXP').value) || 0;
            const unitEnergy = parseFloat(document.getElementById('unitEnergy').value) || 0;
            const unitCost = parseFloat(document.getElementById('unitCost').value) || 0;
            const unitSalePrice = parseFloat(document.getElementById('unitSalePrice').value) || 0;

            let neededXP = 0;
            if (targetLvl > skill.lvl) {
                neededXP = getCumulativeXP(targetLvl) - (getCumulativeXP(skill.lvl) + skill.xp);
            }
            document.getElementById('calcNeededXP').innerText = formatNum(Math.max(0, neededXP));

            if(neededXP <= 0 || unitXP <= 0) { resetResults(); return; }

            const count = Math.ceil(neededXP / unitXP);
            const totalEnergy = count * unitEnergy;
            const energyCost = totalEnergy * ENERGY_PRICE;
            const matCost = count * unitCost;
            const totalCost = energyCost + matCost;
            const totalSales = count * unitSalePrice;
            const profitLoss = totalSales - totalCost;

            document.getElementById('resCount').innerText = formatNum(count);
            document.getElementById('resTotalEnergy').innerText = formatNum(totalEnergy);
            document.getElementById('resEnergyCost').innerText = formatNum(energyCost) + "c";
            document.getElementById('resMatCost').innerText = formatNum(matCost) + "c";
            document.getElementById('resTotalCost').innerText = formatNum(totalCost) + "c";
            document.getElementById('resTotalSales').innerText = formatNum(totalSales) + "c";
            
            const plEl = document.getElementById('resProfitLoss');
            plEl.innerText = formatNum(profitLoss);
            plEl.style.color = profitLoss >= 0 ? '#ccff00' : '#ff4d4d';
        }

        function resetResults() {
            ['resCount', 'resTotalEnergy', 'resEnergyCost', 'resMatCost', 'resTotalCost', 'resTotalSales', 'resProfitLoss'].forEach(id => {
                document.getElementById(id).innerText = "-";
            });
        }

        function formatNum(num) {
            return Math.ceil(num).toLocaleString('tr-TR');
        }
    </script>
</body>
</html>